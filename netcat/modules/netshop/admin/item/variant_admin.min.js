$nc(function(){function k(a){a.preventDefault();var b=d(a.target),c=g(b);b.hasClass("nc--disabled")||(b.addClass("nc--disabled"),a=d.extend(f(c,"request_parameters"),l(c,!0),{checked:"enable"==a.data?2:1}),parent.nc_action_message(NETCAT_PATH+"message.php?","POST",a))}function o(a){var b=f(a,"parent_item_id");i[b]&&i[b].abort();var a=g(a),c=d.extend(f(a,"request_parameters"),{posting:1,multiple_changes:1,isNaked:1,nc_token:nc_token,message:-1});j(a).each(function(a){var b=d(this).data("itemId");c["nc_multiple_changes["+
b+"][Priority]"]=a+1});i[b]=d.post(NETCAT_PATH+"message.php?",c)}function f(a,b){var c=g(a).data("parameters")||{};return b&&b in c?c[b]:c}function j(a,b){return g(a).find("tr[data-item-id]"+(b?"":":not(.nc-netshop-variant-parent)"))}function g(a){return d(a).closest(".nc-netshop-variant")}function l(a,b){var c={};j(a,b).each(function(){var a=d(this).data("itemId");c["message["+a+"]"]=a});return c}function p(a){a.find(".nc-netshop-variant-multiple-field-select").change(q);a.get_part("footer").find("button[data-role=submit]").click(r);
a.find(".nc-netshop-variant-article input[name=fill_article_field]").change(s)}function q(){var a=window.top.$nc(this),b=a.find("option:selected"),c=a.closest("table"),e=c.find("tbody").eq(0),f="options["+b.val()+"][]",g="[name='"+f+"']";e.find(g).length||(b=t(b,f),b.hide().find(g).on("change keyup",function(){m(c)}),e.append(b),b.fadeIn(),c.tableDnD({dragHandle:".nc--move",onDrop:d.noop}),n(c));e.find(g).focus();a.val("")}function t(a,b){var c=a.data("selectValues"),e='<tr class="nc-netshop-variant-multiple-field-row"><td class="nc--compact"><i class="nc-icon nc--move"></i></td><td class="nc-netshop-variant-multiple-field-row-name">'+
a.text()+"</td><td>";if(c){var g=Math.min(Object.keys?Object.keys(c).length:4,4),e=e+('<select name="'+b+'" multiple size="'+g+'">'),f;for(f in c)e+='<option value="'+f+'">'+c[f]+"</option>";e+="</select>"}else e+='<input type="text" name="'+b+'">';e=d(e+'</td><td class="nc--compact"><i class="nc-icon nc--remove"></i></td></tr>');e.find(".nc--remove").click(function(){var a=d(this),b=a.closest("table");a.closest("tr").remove();n(b);m(b)});return e}function m(a){var b=0;a.find("tbody").eq(0).children("tr").find("select, input").each(function(){var a=
d(this).val();if(!d.isArray(a)){a=d.trim(a);if(!a.length)return;a=a.split(u)}a.length&&(b=0==b?a.length:b*a.length)});var a=nc.ui.modal_dialog.get_opened_dialog().get_part("footer"),c=a.find("button[data-role=submit]");0==b?c.addClass("nc--disabled"):c.removeClass("nc--disabled");a.find(".nc-netshop-variant-multiple-count span").text(b)}function n(a){1<a.find("tbody").eq(0).children("tr").length?a.removeClass("nc-netshop-variant-multiple-field-table-no-drag"):a.addClass("nc-netshop-variant-multiple-field-table-no-drag")}
function r(){var a=d(this);if(!a.hasClass("nc--disabled")){a.addClass("nc--loading");var b=nc.ui.modal_dialog.get_opened_dialog(),a=b.find(".nc-netshop-variant-multiple-field-form"),c=a.find("input[name=infoblock_id]").val();a.ajaxSubmit({success:function(){d.ajax({type:"GET",url:nc_page_url()+"&isNaked=1&admin_modal=1&cc_only="+c,success:function(a){nc_update_admin_mode_content(a,null,c);b.close()}})},error:function(a){alert("Error!\n"+a);b.close()}})}}function s(){d(".nc-netshop-variant-article-details").slideToggle(300)}
var d=$nc,h=d("iframe#mainViewIframe").get(0);if(h)d=h.contentWindow.$nc;var u=";",i={},h=window.nc_netshop_init_variant_drag=function(){d(".nc-netshop-variant-table").tableDnD({onDrop:o,dragHandle:".nc-netshop-variant-drag",onDragClass:"nc--dragged"})};d("body").on("click",".nc-netshop-variant-enable-all","enable",k).on("click",".nc-netshop-variant-disable-all","disable",k).on("click",".nc-netshop-variant-edit-all",function(a){a.preventDefault();var a=g(a.target),b=d.extend(f(a,"request_parameters"),
{nc_ctpl:f(a,"edit_template_id"),isModal:1});j(a,!0).each(function(a){b["item_ids["+a+"]"]=d(this).data("itemId")});nc.load_dialog(NETCAT_PATH+"index.php?",b)}).on("click",".nc-netshop-variant-delete-all",function(a){a.preventDefault();var a=g(a.target),a=d.extend(f(a,"request_parameters"),l(a),{"delete":1,posting:0}),b="",c;for(c in a)b+='<input type="hidden" name="'+c.toString().replace('"',"&quot;")+'" value="'+a[c].toString().replace('"',"&quot;")+'" />\n';d("<form />",{action:NETCAT_PATH+"message.php?",
method:"POST",html:b}).appendTo("body").submit()}).on("click",".nc-netshop-variant-add-multiple",function(a){a.preventDefault();a=g(a.target);a=NETCAT_PATH+"modules/netshop/admin/item/create_bulk_dialog.php?component_id="+f(a,"component_id")+"&parent_item_id="+f(a,"parent_item_id");nc.ui.modal_dialog({url:a,on_show:p,confirm_close:!1}).open()});h()});
