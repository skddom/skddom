(function(c,f){function i(a,b){return c("<div>").addClass("tpl-block-popup"+a).append(b)}function r(){if(0>l){var a=c("<div/>").css({position:"absolute",top:-1E3,left:-1E3,width:100,height:100,overflow:"auto"}).prependTo("body").append("<div/>").find("div").css({width:"100%",height:200});l=100-a.width();a.parent().remove()}return l}function m(a,b,e,d,k){var b=i(b+" tpl-block-popup "+a).data({closeAll:d,disableAnimation:k}),g=o(a),a=i("-container"+(k?"":" tpl-state-animated tpl-animation-fade-in-down"),
[c("<a>").addClass("tpl-block-popup-close-button").append(void 0).click(g),i("-icon"),i("-body").html(e)]);b.append([i("-background").click(g),a]).appendTo("body");c(f).off("resize",h).on("resize",h);b.find("img").on("load",h);h();a=c("body");d=c(f);a.data(j)||a.data(j,a.attr("style")||" ");if(c(document).height()>d.height())e=a.offset().left,d=d.width()-a.outerWidth(!0)-e,a.css({"overflow-y":"hidden","margin-left":e+"px","margin-right":d+r()+"px"});a.off(n).on(n,function(a){27==a.keyCode&&g()});
k?b.show():b.fadeIn();return b}function o(a){return function(){var b=".tpl-block-popup."+a,e=c(b),d=e.last(),e=d.data("closeAll")?e:d,d=d.data("disableAnimation")?1:400;e.fadeOut(d,function(){c(this).remove()});setTimeout(function(){if(!c(b).length){c(f).off("resize",h);var a=c("body");a.attr("style",a.data(j)).data(j,"").off(n)}},d+200)}}function h(){c(".tpl-block-popup").each(function(){var a=c(this),b=a.find(".tpl-block-popup-container").css("margin-top",""),e=parseInt(b.css("margin-top"),10),
a=Math.round((a.innerHeight()-b.outerHeight())/2);a>e&&b.css("margin-top",a+"px")})}function p(a){return function(b,c,d){"abort"!=c&&m(a,q,"<h4>"+c+"</h4><p>"+d+"</p>",!1)}}var q="-message tpl-state-error",n="keyup.popup-close",j="ncRequestsStyle",l=-1;f.nc_requests_form_init=function(a,b,e){b=c(b||"body").parent().find("."+a.replace(/\s+/,".")+" form");b.off("submit.ajax-submit").on("submit.ajax-submit",function(b){b.preventDefault();if(e)return!1;b=c(this);c.ajax({type:b.attr("method"),url:b.attr("action"),
data:b.serialize()+"&isNaked=1",success:function(b){var c=0>b.indexOf("error");m(a,c?"-message tpl-state-success":q,b,c,!1)},error:p(a)})});e&&b.find("input,select,textarea,button").prop("tabindex",-1)};f.nc_requests_form_popup_init=function(a,b,e,d,k){var g=c(b);if(!g.length)throw"Button not found: "+b;var f=g.closest("form");f.length||(f=c("<form/>"),g.wrap(f));for(var i in d)c("<input>",{type:"hidden",name:i,value:d[i]}).appendTo(f);k&&(g.wrap(c("<div/>").css({position:"relative",display:"inline-block"})).after(k),
nc_modal_dialog_trigger_init());var h=!!k,j;g.off("click.ajax-load").on("click.ajax-load",function(b){b.preventDefault();j&&j.abort();var d={type:"POST",url:f.attr("action")||e,data:f.serialize()+"&isNaked=1",success:function(b){c(document).trigger("nc_requests_form_popup_loaded");var e=m(a,"-form",b,!0,h).data({requestParameters:d,formBlockClasses:a});nc_requests_form_init(a,e,h);h||setTimeout(function(){e.find("input,select,textarea").filter(":visible").first().focus()},450)},error:p(a)};j=c.ajax(d)})};
f.nc_requests_form_popup_reload=function(){c(".tpl-block-popup").each(function(){var a=c(this),b=a.data("formBlockClasses"),a=a.data("requestParameters");b&&a&&(c.ajax(a),c(document).one("nc_requests_form_popup_loaded",o(b)))})}})(jQuery,window);
